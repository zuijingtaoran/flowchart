((a,b,c)=>{var d=Math.sqrt;window.net=new class{constructor(){this.viewBox=[0,0,document.getElementById("box").clientWidth,document.getElementById("box").clientHeight],this.RawData=rawdata,this.init()}init(){let a=this,b=[],c=a.viewBox[2]/(a.RawData.NodeDataset.length+2),d=a.viewBox[3]/2.414,e=a.RawData,f=JSON.parse(localStorage.getItem("layout")||"[{\"data\":[]}]"),g={};f[0].data.map(a=>(g[a.Id]=a.location,a)),e.NodeDataset.map((a,b)=>{var e=Math.floor;a.location=!g[a.Id]?[e(c*(b+1)),e(d+(2*(b%2)-1)*(d/2))]:g[a.Id]}),a.render(),e.NodeDataset.map(c=>{b.push(a.centerpoint(c))}),b=_.uniq(_.flattenDeep(b).map(a=>JSON.stringify(a))).map(a=>JSON.parse(a)),a.arrow(b)}render(){let e=this,f=1;a.svg=b().addTo("#box").size(...e.viewBox.slice(-2)).viewbox(...e.viewBox).attr({id:"flowchart_box"}),e.RawData.NodeDataset.map(b=>{switch(b.Shape){case"Circle":b.len=b.Size/2,b.element=a.svg.circle(b.Size*f).fill(b.BackGroundColor).move(...b.location);break;case"Rectangle":let c=100/b.Size/f;b.len=b.Size/1,b.element=a.svg.polygon(`${300/c},${200/c} 
		${250/c},${113.3975/c} 
		${150/c},${113.3975/c} 
		${100/c},${200/c} 
		${150/c},${286.6025/c} 
		${250/c},${286.6025/c}`).fill(b.BackGroundColor).move(...b.location);break;case"Histogam":b.len=b.Size/2,b.element=a.svg.rect(b.Size*f,b.Size).fill(b.BackGroundColor).move(...b.location);break;case"Image":b.len=b.Size/2,b.element=a.svg.image(b.URL).size(b.Size*f,b.Size).move(...b.location);break;case"Iframe":b.len=b.Size/2;"_"+Math.random().toString(36).substr(2);b.element=a.svg.foreignObject(b.Size*f,b.Size).move(...b.location),b.element.add("<div class=iframedrag>"+b.Text+"</div>"),setTimeout(function(){b.element.node.innerHTML="<body xmlns=\"http://www.w3.org/1999/xhtml\"><div class=iframedrag>"+b.Text+"</div><iframe  frameborder=\"0\" src=\""+b.URL+"\"></iframe></body>"},200);break;default:b.len=b.Size/2,b.element=a.svg.rect(b.Size,b.Size*f).fill(b.BackGroundColor).move(...b.location);}b.element.attr({id:b.Id,ShiningColor:b.ShiningColor||"",class:"element "}).draggable();let[g,h,i,j,k,l]=[b.element,0,0,0,0,null];g.on("dragstart",function(){l=g.clone().opacity(.34),a.svg.add(l),[h,j]=[g.x(),g.y()]}),g.on("dragmove",function(){}),g.on("dragend",function(){let a=[];[i,k]=[g.x(),g.y()];d((h-i)*(h-i)+(j-k)*(j-k));l.remove(),b.location=[i,k],a.push(e.centerpoint(b)),e.arrow(_.flattenDeep(a))}),g.on("mouseover",function(a){[h,j]=[g.x(),g.y()],a.preventDefault(),c("#tooltip").html(b.ToolTip).css({top:j,left:h+b.Size/2}).show()}),g.on("mouseout",function(a){c("#tooltip").hide(),a.preventDefault()})})}centerpoint(a){let b=this,c=b.RawData,d=[];return _.flatMap(c.DataDataset,function(b){return b.From==a.Id}).map((b,e)=>{b&&(!c.DataDataset[e].sid&&(c.DataDataset[e].sid=c.DataDataset[e].From+"_"+c.DataDataset[e].To),c.DataDataset[e].f=a.location.map(b=>b+a.len),d.push(c.DataDataset[e]))}),_.flatMap(c.DataDataset,function(b){return b.To==a.Id}).map((b,e)=>{b&&(!c.DataDataset[e].sid&&(c.DataDataset[e].sid=c.DataDataset[e].From+"_"+c.DataDataset[e].To),c.DataDataset[e].t=a.location.map(b=>b+a.len),d.push(c.DataDataset[e]))}),d}arrow(b){var c=this,e=c.RawData.NodeDataset;b.map(b=>{var f=Math.pow;let[g,h,i,j,l,m,n,o]=[0,0,0,0,+_.filter(e,function(a){return a.Id==b.From})[0].len,+_.filter(e,function(a){return a.Id==b.To})[0].len+10,(b.t[0]-b.f[0])/d(f(b.t[0]-b.f[0],2)+f(b.t[1]-b.f[1],2)),(b.t[1]-b.f[1])/(b.t[0]-b.f[0])];i=b.t[0]-m*n,j=b.t[1]-o*(b.t[0]-i),b.ct=[i,j],g=b.f[0]+l*n,h=b.f[1]+o*(g-b.f[0]),b.cf=[g,h];try{b.element.remove(),b.text.remove()}catch(a){}if("Curve"==b.CurveStyle){let d=c.Berzier(...b.cf,...b.ct);b.element=a.svg.path(d).attr({stroke:b.Color,"stroke-width":b.Size,"stroke-dasharray":"Dash"===b.DashStyle?"5":"0",fill:"none"})}else b.element=a.svg.line(...b.cf,...b.ct).attr({stroke:b.Color,"stroke-width":b.Size,"stroke-dasharray":"Dash"===b.DashStyle?"5":"0",fill:"none"});b.text=a.svg.text(function(a){a.tspan(b.Label).dy(20)}),b.text.path(c.textpath(...b.cf,...b.ct,b.CurveStyle)).font({size:20.5,family:"Verdana"}),b.text.textPath().attr("startOffset","30%"),b.element.marker("end",6,6,function(a){a.path("M 0 0 L 6 3 L 0 6 z").fill(b.Color)}),b.element.on("mouseover",function(){}),_.assign(_.filter(c.RawData.DataDataset,function(a){return a.sid==b.sid})[0],b)})}BerzierLine(a,b,c,d){return`M ${a},${b} Q ${(a+c)/2},${b} ${(a+c)/2},${(b+d)/2} T ${c},${d}`}Berzier(a,b,c,d){return`M${a} ${b} C${(a+c)/1.9} ${b} ${c} ${d} ${c} ${d}`}textpath(b,c,d,e,f){return+b>+d&&([b,d]=[d,b],[c,e]=[e,c]),`M ${b} ${c} L ${d} ${e}`}}})(window,SVG,(()=>Z)());